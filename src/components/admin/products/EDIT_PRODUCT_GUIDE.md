# Руководство по редактированию товаров

## Обзор

Реализована полнофункциональная система редактирования товаров с поддержкой управления вариантами, включая:

- ✅ Редактирование основной информации о товаре
- ✅ Добавление новых вариантов товара
- ✅ Редактирование существующих вариантов
- ✅ Удаление вариантов
- ✅ Управление изображениями для каждого варианта
- ✅ Добавление дополнительных атрибутов
- ✅ Установка цен и скидок

## Основные возможности

### Редактирование товара
- **Название** - изменение названия товара
- **Описание** - редактирование описания
- **Категория** - изменение категории товара
- **Статус** - активация/деактивация товара

### Управление вариантами
- **Добавление вариантов** - создание новых вариантов с уникальными характеристиками
- **Редактирование** - изменение параметров существующих вариантов
- **Удаление** - удаление ненужных вариантов

### Параметры варианта
- **Размер** - выбор из предустановленных или ввод кастомного размера
- **Цвет** - выбор из палитры или ввод hex-кода цвета
- **Артикул (SKU)** - уникальный код товара (опционально)
- **Количество** - количество в наличии
- **Цена** - основная цена товара
- **Цена со скидкой** - опциональная скидочная цена
- **Дополнительные атрибуты** - неограниченное количество пар "название-значение"
- **Изображения** - множественные изображения с возможностью установки главного

## Использование

### Открытие редактирования
1. На странице товаров нажмите кнопку "Редактировать" (иконка карандаша) рядом с товаром
2. Откроется полнофункциональное модальное окно редактирования

### Редактирование основной информации
1. Измените необходимые поля в разделе "Основная информация"
2. Используйте переключатель для активации/деактивации товара

### Работа с вариантами
1. **Просмотр существующих вариантов** - все варианты отображаются в списке с основной информацией
2. **Добавление нового варианта** - нажмите "Добавить вариант"
3. **Редактирование варианта** - нажмите иконку карандаша рядом с вариантом
4. **Удаление варианта** - нажмите иконку корзины рядом с вариантом

### Создание/редактирование варианта
1. **Заполните обязательные поля**: размер, цвет, цену, количество
2. **Добавьте SKU** (опционально)
3. **Установите скидку** при необходимости
4. **Добавьте атрибуты** - введите название и значение, нажмите "+"
5. **Загрузите изображения** - нажмите "Управление изображениями"

### Управление изображениями
- Поддерживаются форматы: JPG, PNG, WebP
- Максимальный размер файла: 10MB
- Первое изображение автоматически становится главным
- Возможность перетаскивания файлов и ввода URL

## API Endpoints

### GET /api/admin/products/[id]
Получение полной информации о товаре с вариантами

### PUT /api/admin/products/[id]
Обновление товара со всеми вариантами

### DELETE /api/admin/products/[id]
Удаление товара со всеми связанными данными

## Структура данных

```typescript
interface ProductFormData {
  name: string;
  description: string;
  categoryId: string;
  isActive: boolean;
  variants: ProductVariant[];
}

interface ProductVariant {
  id: string;
  size: string;
  color: string;
  sku: string;
  quantity: number;
  price: number;
  discountPrice?: number;
  attributes: { name: string; value: string }[];
  images: string[];
}
```

## Особенности реализации

### Транзакционность
- Все изменения выполняются в рамках одной транзакции
- При ошибке все изменения откатываются
- Сначала удаляются старые варианты, затем создаются новые

### Валидация
- Проверка обязательных полей
- Валидация типов данных
- Проверка существования категории
- Минимум один вариант товара обязателен

### UX/UI
- Интуитивный интерфейс с четкой структурой
- Предварительный просмотр изображений
- Индикаторы загрузки
- Уведомления об успешных операциях и ошибках
- Адаптивный дизайн для мобильных устройств

## Безопасность

- Проверка существования товара перед редактированием
- Валидация всех входящих данных
- Безопасное удаление связанных записей
- Обработка ошибок с информативными сообщениями

## Производительность

- Оптимизированные запросы к базе данных
- Пакетные операции для вариантов
- Ленивая загрузка изображений
- Минимальные re-renders компонентов
